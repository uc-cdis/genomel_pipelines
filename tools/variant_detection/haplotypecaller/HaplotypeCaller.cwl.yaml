#!/usr/bin/env cwl-runner

cwlVersion: "cwl:draft-3"

class: CommandLineTool

requirements:
  - $import: ../../envvar-global.cwl
  - class: InlineJavascriptRequirement
  - class: ShellCommandRequirement
  - class: MultipleInputFeatureRequirement
  - class: DockerRequirement
    dockerPull: registry.gitlab.com/uc-cdis/genomel-exome-variant-detection:0.1b

inputs:
  - id: java_opts
    type: string
    default: "-Xmx32g -XX:+UseConcMarkSweepGC -XX:-UseGCOverheadLimit"
    description: |
      "JVM arguments should be a quoted, space separated list (e.g. \"-Xmx8g -Xmx16g -Xms128m -Xmx512m\")"
    inputBinding:
      position: 1
      shellQuote: false
  - id: input_bam_path
    type: File
    inputBinding:
      position: 4
      prefix: "-I"
    secondaryFiles:
      - "^.bai"
  - id: reference_fasta_path
    type: File
    inputBinding:
      position: 5
      prefix: "-R"
    secondaryFiles:
      - "^.dict"
      - ".fai"
  - id: interval_file_path
    type: ["null", File]
    inputBinding:
      position: 6
      prefix: "-L"
  - id: reference_snp_path
    type: ["null", File]
    inputBinding:
      position: 7
      prefix: "-D"
  - id: output_gvcf_name
    type: string
    inputBinding:
      position: 8
      prefix: "-o"

outputs:
  - id: output_gvcf
    type: File
    outputBinding:
      glob: $(inputs.output_gvcf_name)
    secondaryFiles:
      - ".tbi"

baseCommand: java
arguments:
  - valueFrom: /home/ubuntu/tools/GenomeAnalysisTK.jar
    position: 2
    prefix: -jar
  - valueFrom: HaplotypeCaller
    position: 3
    prefix: -T
  - valueFrom: GVCF
    position: 8
    prefix: --emitRefConfidence
  - valueFrom: LINEAR
    position: 9
    prefix: --variant_index_type
  - valueFrom: "128000"
    position: 10
    prefix: --variant_index_parameter
  - valueFrom: "250"
    position: 11
    prefix: -dcov
  - valueFrom: "3"
    position: 12
    prefix: -minPruning
  - valueFrom: "30"
    position: 13
    prefix: -stand_call_conf
  - valueFrom: "30"
    position: 14
    prefix: -stand_emit_conf
  - valueFrom: Standard
    position: 15
    prefix: -G
  - valueFrom: AlleleBalance
    position: 16
    prefix: -A
  - valueFrom: Coverage
    position: 17
    prefix: -A
  - valueFrom: HomopolymerRun
    position: 18
    prefix: -A
  - valueFrom: QualByDepth
    position: 19
    prefix: -A


description: |
    This tool uses a Bayesian genotype likelihood model to estimate simultaneously the most likely genotypes and allele frequency in a population of N samples, emitting a genotype for each sample. The system can either emit just the variant sites or complete genotypes (which includes homozygous reference calls) satisfying some phred-scaled confidence value.
